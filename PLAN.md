# План реализации функций AI-обработки статей

## Текущее состояние

- ✅ Реализован парсинг HTML статей (извлечение даты, заголовка, контента)
- ✅ Реализован перевод статьи через OpenRouter AI (модель Deepseek)
- ✅ Интерфейс с полем ввода URL и кнопками действий
- ✅ Блок отображения результатов

## Задачи для реализации

### 1. Функция "О чем статья?"

**Цель:** Генерировать краткое описание/резюме статьи на русском языке.

**Шаги реализации:**

1. Создать API route `/app/api/summarize/route.ts`:
   - Принимать распарсенный контент статьи (title + content)
   - Формировать промпт для AI с инструкцией создать краткое резюме
   - Использовать OpenRouter API с моделью Deepseek
   - Возвращать краткое описание статьи (2-3 абзаца)

2. Обновить `app/page.tsx`:
   - В функции `handleSubmit` добавить обработку действия "О чем статья?"
   - После парсинга вызывать API `/api/summarize`
   - Отображать результат в блоке результата как текст

3. Промпт для AI:
   ```
   Ты профессиональный аналитик. Прочитай следующую статью и создай краткое 
   резюме на русском языке (2-3 абзаца), объясняющее основную тему и ключевые 
   моменты статьи.
   
   Заголовок: {title}
   Контент: {content}
   ```

### 2. Функция "Тезисы"

**Цель:** Генерировать структурированный список основных тезисов статьи.

**Шаги реализации:**

1. Создать API route `/app/api/theses/route.ts`:
   - Принимать распарсенный контент статьи
   - Формировать промпт для AI с инструкцией выделить основные тезисы
   - Использовать OpenRouter API с моделью Deepseek
   - Возвращать список тезисов в структурированном виде (маркированный список)

2. Обновить `app/page.tsx`:
   - В функции `handleSubmit` добавить обработку действия "Тезисы"
   - После парсинга вызывать API `/api/theses`
   - Отображать результат в блоке результата как форматированный текст

3. Промпт для AI:
   ```
   Ты профессиональный аналитик. Прочитай следующую статью и выдели основные 
   тезисы (ключевые идеи, утверждения, выводы). Представь их в виде 
   структурированного списка на русском языке. Каждый тезис должен быть 
   кратким и содержательным.
   
   Заголовок: {title}
   Контент: {content}
   ```

### 3. Функция "Пост для Telegram"

**Цель:** Генерировать форматированный пост для публикации в Telegram.

**Шаги реализации:**

1. Создать API route `/app/api/telegram-post/route.ts`:
   - Принимать распарсенный контент статьи (title, date, content)
   - Формировать промпт для AI с инструкцией создать пост для Telegram
   - Использовать OpenRouter API с моделью Deepseek
   - Возвращать отформатированный пост с использованием Markdown для Telegram

2. Обновить `app/page.tsx`:
   - В функции `handleSubmit` добавить обработку действия "Пост для Telegram"
   - После парсинга вызывать API `/api/telegram-post`
   - Отображать результат в блоке результата как текст с поддержкой Markdown

3. Промпт для AI:
   ```
   Ты профессиональный копирайтер. На основе следующей статьи создай пост 
   для Telegram на русском языке. Пост должен быть:
   - Интересным и привлекающим внимание
   - Структурированным (используй Markdown: **жирный**, *курсив*, списки)
   - Содержать краткое резюме и ключевые моменты
   - Иметь призыв к действию или вопрос для обсуждения
   - Длина: 500-800 символов
   
   Заголовок: {title}
   Дата: {date}
   Контент: {content}
   ```

## Общая архитектура

### Последовательность действий для каждой функции:

1. **Парсинг статьи** (уже реализовано):
   - Пользователь вводит URL
   - Вызывается `/api/parse`
   - Извлекаются: date, title, content

2. **AI-обработка** (нужно реализовать):
   - В зависимости от выбранной кнопки вызывается соответствующий API:
     - `/api/summarize` для "О чем статья?"
     - `/api/theses` для "Тезисы"
     - `/api/telegram-post` для "Пост для Telegram"
   - Передаются распарсенные данные (title, content, date)
   - AI генерирует ответ согласно промпту

3. **Отображение результата** (уже реализовано):
   - Результат выводится в блоке результата
   - Поддерживается форматирование текста

## Технические детали

### Общие требования для всех API routes:

- Использовать переменную окружения `OPENROUTER_API_KEY` из `.env.local`
- Использовать модель `deepseek/deepseek-chat`
- Обрабатывать ошибки и возвращать понятные сообщения
- Устанавливать правильные заголовки Content-Type с charset=utf-8
- Не использовать кириллицу в HTTP заголовках

### Структура API route (пример):

```typescript
import { NextRequest, NextResponse } from 'next/server';

export async function POST(request: NextRequest) {
    try {
        const { title, content, date } = await request.json();
        
        // Валидация
        // Вызов OpenRouter API
        // Обработка ответа
        // Возврат результата
        
    } catch (error) {
        // Обработка ошибок
    }
}
```

## Порядок реализации

1. **Этап 1:** Реализовать функцию "О чем статья?"
   - Создать `/app/api/summarize/route.ts`
   - Обновить `handleSubmit` в `app/page.tsx`
   - Протестировать

2. **Этап 2:** Реализовать функцию "Тезисы"
   - Создать `/app/api/theses/route.ts`
   - Обновить `handleSubmit` в `app/page.tsx`
   - Протестировать

3. **Этап 3:** Реализовать функцию "Пост для Telegram"
   - Создать `/app/api/telegram-post/route.ts`
   - Обновить `handleSubmit` в `app/page.tsx`
   - Протестировать

4. **Этап 4:** Оптимизация и улучшения
   - Добавить обработку длинных статей (разбиение на части)
   - Улучшить промпты на основе результатов тестирования
   - Добавить кэширование результатов (опционально)
   - Улучшить форматирование вывода

## Примечания

- Все функции используют уже реализованный парсинг статьи
- Все функции используют один и тот же API (OpenRouter) и модель (Deepseek)
- Промпты можно улучшать итеративно на основе результатов тестирования
- При необходимости можно добавить параметры настройки (длина резюме, количество тезисов и т.д.)
